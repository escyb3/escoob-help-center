<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×›×– ××©×—×§×™ ×—× ×•×›×”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; }
        .game-canvas { height: 500px; }
        @keyframes bounce-subtle { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-bounce-subtle { animation: bounce-subtle 2s infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .draw-progress {
            animation: progress 10s linear forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen overflow-hidden">

    <div id="app" class="flex flex-col md:flex-row h-screen">
        <!-- Sidebar Navigation -->
        <nav class="fixed bottom-0 w-full md:relative md:w-24 bg-white border-t md:border-t-0 md:border-l flex md:flex-col justify-around md:justify-center items-center p-4 gap-8 z-50 shadow-lg">
            <button onclick="showSection('lobby')" class="nav-btn p-4 rounded-2xl transition-all text-blue-600 bg-blue-50" id="btn-lobby">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            </button>
            <button onclick="showSection('leaderboard')" class="nav-btn p-4 rounded-2xl transition-all text-slate-300 hover:text-slate-600" id="btn-leaderboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
            </button>
        </nav>

        <main class="flex-1 overflow-y-auto pb-24 md:pb-0">
            <!-- Lobby Section -->
            <section id="lobby" class="section p-8 max-w-6xl mx-auto fade-in">
                <header class="mb-12">
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-12 h-1 bg-yellow-400 rounded-full"></div>
                        <span class="text-yellow-600 font-bold tracking-widest uppercase text-sm italic">Hanukkah Special 2024</span>
                    </div>
                    <h1 class="text-6xl font-black text-slate-900 mb-2">×¢×•×œ× ×”××©×—×§×™×</h1>
                    <p class="text-2xl text-blue-600 font-medium italic">×—×’ ××•×¨×™× ×©××— ×•××œ× ××ª×’×¨×™×!</p>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="games-grid">
                    <!-- Games will be injected here -->
                </div>
            </section>

            <!-- Game Player Section -->
            <section id="game-view" class="section hidden h-full flex flex-col fade-in">
                <div class="bg-white p-5 flex justify-between items-center shadow-sm border-b">
                    <button onclick="stopAllTimers(); showSection('lobby')" class="flex items-center gap-2 text-slate-600 font-bold hover:text-blue-600 px-4 py-2 rounded-xl transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        ×—×–×¨×” ×œ×œ×•×‘×™
                    </button>
                    <h2 id="current-game-title" class="text-xl font-black text-slate-800 uppercase text-center flex-1">×©× ×”××©×—×§</h2>
                </div>
                <div class="flex-1 p-4 flex items-center justify-center overflow-hidden bg-slate-100" id="game-container">
                    <!-- Game content injected here -->
                </div>
            </section>

            <!-- Leaderboard Section -->
            <section id="leaderboard" class="section hidden p-8 max-w-4xl mx-auto fade-in">
                <div class="flex items-center justify-between mb-8">
                    <h1 class="text-4xl font-black text-slate-900 tracking-tight">×”×™×›×œ ×”×ª×”×™×œ×”</h1>
                </div>
                <div class="bg-white rounded-[2rem] shadow-xl overflow-hidden border border-slate-100">
                    <div class="bg-slate-900 p-6 text-white flex justify-between items-center font-bold">
                        <span class="w-1/6 text-center">××™×§×•×</span>
                        <span class="w-2/6 text-right">×©×—×§×Ÿ</span>
                        <span class="w-2/6 text-right">××©×—×§</span>
                        <span class="w-1/6 text-left">×¦×™×•×Ÿ</span>
                    </div>
                    <div id="leaderboard-list" class="divide-y divide-gray-50 min-h-[400px]">
                        <!-- Results injected here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        let scores = [];
        let activeIntervals = [];
        const apiKey = "";

        const games = [
            { id: 'shamash_hunter', title: '×¦×™×™×“ ×”×©××©×™×', description: '×ª×¤×¡×• ×›××” ×©×™×•×ª×¨ ×©××©×™× ×‘-30 ×©× ×™×•×ª! ×”×™×× ×¢×• ××”×¡×‘×™×‘×•× ×™× ×”××“×•××™×.', grade: '×-×•', icon: 'ğŸ”¥', color: 'bg-orange-500', textColor: 'text-white' },
            { id: 'maccabee_shield', title: '××’×Ÿ ×”××›×‘×™×', description: '××©×—×§ ×”×’× ×”: ××œ ×ª×ª× ×• ×œ×¡×‘×™×‘×•× ×™× ×œ×¤×’×•×¢ ×‘×× ×•×¨×”! ××”×™×¨×•×ª ×”×™× ×”××¤×ª×—.', grade: '×’-×•', icon: 'ğŸ›¡ï¸', color: 'bg-red-600', textColor: 'text-white' },
            { id: 'light_memory', title: '×–×™×›×¨×•×Ÿ ×”××•×¨', description: '××©×—×§ ×”×–×™×›×¨×•×Ÿ ×©×œ ×—× ×•×›×”. ××¦××• ××ª ×”×–×•×’×•×ª ×›××” ×©×™×•×ª×¨ ××”×¨.', grade: '×›×œ ×”×’×™×œ××™×', icon: 'ğŸ§©', color: 'bg-emerald-600', textColor: 'text-white' },
            { id: 'donut_plane', title: '××˜×•×¡ ×”×¡×•×¤×’× ×™×•×ª', description: '×”×˜×™×¡×• ××ª ×”×¡×•×¤×’× ×™×” ×‘×™×Ÿ ×”×—× ×•×›×™×•×ª! ××©×—×§ ×–×¨×™×–×•×ª ××”× ×”.', grade: '×-×‘', icon: 'âœˆï¸', color: 'bg-pink-500', textColor: 'text-white' },
            { id: 'visual_mystery', title: '×—×™×“×•×Ÿ ×”×ª××•× ×•×ª (17 ×©×œ×‘×™×)', description: '×”××¢×¨×›×ª ××¦×™×™×¨×ª ×“×‘×¨×™× ××•×¨×›×‘×™× ×•××•×¡×ª×¨×™×. ×”×× ×ª×¦×œ×™×—×• ×œ×–×”×•×ª?', grade: '×‘-×˜', icon: 'ğŸ¨', color: 'bg-purple-600', textColor: 'text-white' },
            { id: 'trivia_kids', title: '××•××—×” ×—× ×•×›×” (×“-×–)', description: '×—×™×“×•×Ÿ ×—× ×•×›×” ××§×™×£ ×œ×™×œ×“×™×. ××”×™×¨×•×ª ××©×¤×¨×ª ××ª ×”×¦×™×•×Ÿ.', grade: '×“-×–', icon: 'â­', color: 'bg-blue-600', textColor: 'text-white' },
            { id: 'trivia_adults', title: '×—×›××™ ×—× ×•×›×” (××‘×•×’×¨×™×)', description: '24 ×©××œ×•×ª ×§×©×•×ª. ×›×›×œ ×©×ª×¢× ×• ××”×¨ ×™×•×ª×¨, ×ª×¢×œ×• ×‘×“×™×¨×•×’.', grade: '××‘×•×’×¨×™×', icon: 'ğŸ“œ', color: 'bg-slate-900', textColor: 'text-white' },
            { id: 'hanukkah_race', title: '××¨×•×¥ ×”×¡×•×¤×’× ×™×•×ª', description: '×–×¨×™×–×•×ª: ××¡×¤×• ×¡×•×¤×’× ×™×•×ª ×•×”×™×× ×¢×• ××¡×‘×™×‘×•× ×™×.', grade: '×-×’', icon: 'ğŸ©', color: 'bg-white', textColor: 'text-slate-900' },
            { id: 'dreidel_gold', title: '×¡×‘×™×‘×•×Ÿ ×”×–×”×‘', description: '×–×”×• ××ª ×”××•×ª ×”××•×¤×™×¢×” ×‘××”×™×¨×•×ª.', grade: '×‘-×“', icon: 'ğŸŒ€', color: 'bg-white', textColor: 'text-slate-900' }
        ];

        function stopAllTimers() {
            activeIntervals.forEach(clearInterval);
            activeIntervals = [];
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            if(sectionId === 'leaderboard') renderLeaderboard();
        }

        function renderLobby() {
            const grid = document.getElementById('games-grid');
            grid.innerHTML = games.map((game, idx) => `
                <div class="${game.color} ${game.textColor} p-8 rounded-[2.5rem] shadow-sm hover:shadow-2xl transition-all border border-slate-100 cursor-pointer flex flex-col group fade-in" 
                     onclick="launchGame('${game.id}')">
                    <div class="mb-6 w-16 h-16 rounded-2xl flex items-center justify-center text-4xl bg-black/5 group-hover:scale-110 transition-transform">${game.icon}</div>
                    <span class="${game.textColor === 'text-white' ? 'bg-white/20' : 'bg-blue-50'} px-3 py-1 rounded-full text-xs font-bold w-fit mb-3">${game.grade}</span>
                    <h3 class="text-3xl font-black mb-2">${game.title}</h3>
                    <p class="opacity-70 text-lg mb-8 flex-1">${game.description}</p>
                    <button class="w-full bg-yellow-400 text-slate-900 py-4 rounded-2xl font-bold text-xl transition-all active:scale-95">×©×—×§ ×¢×›×©×™×•</button>
                </div>
            `).join('');
        }

        function launchGame(gameId) {
            stopAllTimers();
            const game = games.find(g => g.id === gameId);
            document.getElementById('current-game-title').innerText = game.title;
            showSection('game-view');
            const container = document.getElementById('game-container');
            container.innerHTML = '';

            if (gameId === 'shamash_hunter') startShamashHunter(container);
            else if (gameId === 'maccabee_shield') startMaccabeeShield(container);
            else if (gameId === 'light_memory') startLightMemory(container);
            else if (gameId === 'donut_plane') startDonutPlane(container);
            else if (gameId === 'visual_mystery') startVisualMystery(container);
            else if (gameId === 'hanukkah_race') startRace(container);
            else if (gameId === 'trivia_kids') startTrivia(container, 'kids');
            else if (gameId === 'trivia_adults') startTrivia(container, 'adults');
            else if (gameId === 'dreidel_gold') startDreidel(container);
        }

        // --- ××©×—×§: ×—×™×“×•×Ÿ ×”×ª××•× ×•×ª (×’×¨×¡×” ××©×•×¤×¨×ª - 17 ×©×œ×‘×™× ×§×©×™×) ---
        async function startVisualMystery(container) {
            const levels = [
                { prompt: "A complex crowd of people in a busy futuristic market, a small traditional dreidel is hidden on a shelf behind many mechanical toys", answer: "×¡×‘×™×‘×•×Ÿ", options: ["×¡×‘×™×‘×•×Ÿ", "×¡×•×¤×’× ×™×”", "×—× ×•×›×™×™×”"] },
                { prompt: "A vast landscape of clouds, a golden menorah disguised as a bridge connecting two floating islands", answer: "×—× ×•×›×™×™×”", options: ["× ×¨", "×—× ×•×›×™×™×”", "×›×“ ×©××Ÿ"] },
                { prompt: "Macro shot of a busy honeycomb, one of the cells is actually shaped like a jelly donut", answer: "×¡×•×¤×’× ×™×”", options: ["××˜×‘×¢", "×¡×•×¤×’× ×™×”", "×¡×‘×™×‘×•×Ÿ"] },
                { prompt: "Inside a clock mechanism, gears shaped like Jewish dreidels, sepia tone, very detailed and crowded", answer: "×¡×‘×™×‘×•×Ÿ", options: ["×¡×‘×™×‘×•×Ÿ", "××›×‘×™×", "× ×¨"] },
                { prompt: "A dark laboratory with thousands of glass jars, one jar in the far background contains glowing olive oil", answer: "×›×“ ×©××Ÿ", options: ["××™×", "×›×“ ×©××Ÿ", "×™×™×Ÿ"] },
                { prompt: "A forest where the trees have branches that look like a Hanukkah menorah, winter night, snowy", answer: "×—× ×•×›×™×™×”", options: ["×¢×¥", "×—× ×•×›×™×™×”", "×©×™×—"] },
                { prompt: "Steampunk city aerial view, a giant fountain in the center is shaped like a spinning dreidel", answer: "×¡×‘×™×‘×•×Ÿ", options: ["××–×¨×§×”", "×¡×‘×™×‘×•×Ÿ", "×¤×¡×œ"] },
                { prompt: "Microscopic view of sugar crystals, some crystals form the shape of a donut", answer: "×¡×•×¤×’× ×™×”", options: ["××œ×—", "×¡×•×¤×’× ×™×”", "×™×”×œ×•×"] },
                { prompt: "An ancient library where a candle's flame is actually a tiny soldier (Maccabee) holding a shield", answer: "××›×‘×™×", options: ["× ×¨", "××›×‘×™×", "×¡×¤×¨"] },
                { prompt: "A mosaic made of thousands of small coins, the overall image forms a Hanukkah menorah", answer: "×—× ×•×›×™×™×”", options: ["×—× ×•×›×™×™×”", "××˜×‘×¢", "×§×™×¨"] },
                { prompt: "A kitchen full of utensils, a wooden dreidel is hidden inside a bowl of walnuts", answer: "×¡×‘×™×‘×•×Ÿ", options: ["××’×•×–", "×¡×‘×™×‘×•×Ÿ", "×›×£"] },
                { prompt: "Starry night sky where the constellations form the shape of a clay oil jar", answer: "×›×“ ×©××Ÿ", options: ["×“×•×‘×” ×’×“×•×œ×”", "×›×“ ×©××Ÿ", "×™×¨×—"] },
                { prompt: "A toy store window with hundreds of items, a Hanukkah donut is camouflaged next to a pile of red balls", answer: "×¡×•×¤×’× ×™×”", options: ["×›×“×•×¨", "×¡×•×¤×’× ×™×”", "×‘×•×‘×”"] },
                { prompt: "Abstract art with geometric shapes, hidden within the lines is the Hebrew letter 'Gimel' on a dreidel", answer: "×¡×‘×™×‘×•×Ÿ", options: ["×¡×‘×™×‘×•×Ÿ", "××•×ª", "×¦×™×•×¨"] },
                { prompt: "A Roman battlefield, a soldier's shield has a menorah engraved very faintly", answer: "×—× ×•×›×™×™×”", options: ["××’×Ÿ", "×—× ×•×›×™×™×”", "×—×¨×‘"] },
                { prompt: "A box of chocolate pralines, one is shaped like a small Hanukkah jug", answer: "×›×“ ×©××Ÿ", options: ["×©×•×§×•×œ×“", "×›×“ ×©××Ÿ", "×¡×•×›×¨×™×™×”"] },
                { prompt: "Underwater coral reef where the corals form the structure of a 9-branched menorah", answer: "×—× ×•×›×™×™×”", options: ["×“×’", "×—× ×•×›×™×™×”", "××œ××•×’"] }
            ];
            
            let currentLevel = 0, score = 0;
            
            function showLoading() {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center bg-white p-12 rounded-3xl shadow-xl max-w-md w-full">
                        <div class="text-6xl mb-6 animate-bounce">ğŸ¨</div>
                        <p class="text-xl font-bold text-purple-600 mb-4">×”××¢×¨×›×ª ××™×™×¦×¨×ª ××ª×’×¨ ×§×©×”...</p>
                        <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden">
                            <div class="bg-purple-500 h-full draw-progress"></div>
                        </div>
                        <p class="text-slate-400 mt-4 text-sm italic">××¦×™×™×¨×ª ×¡×‘×™×‘×” ×¢××•×¡×” ×•×¤×¨×˜×™× × ×¡×ª×¨×™×...</p>
                    </div>`;
            }

            async function generateImage(prompt) {
                try {
                    const apiPromise = fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                        method: 'POST',
                        body: JSON.stringify({ instances: [{ prompt: "High complexity, hidden object style: " + prompt }], parameters: { sampleCount: 1 } })
                    });
                    
                    const timeoutPromise = new Promise(resolve => setTimeout(resolve, 10000));
                    const [response] = await Promise.all([apiPromise, timeoutPromise]);
                    const result = await response.json();
                    return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                } catch (e) {
                    return "https://via.placeholder.com/400x400?text=Generation+Limit+Reached";
                }
            }

            async function loadLevel() {
                if (currentLevel >= levels.length) {
                    saveScoreModal(score, '×—×™×“×•×Ÿ ×”×ª××•× ×•×ª');
                    return;
                }
                showLoading();
                const imgUrl = await generateImage(levels[currentLevel].prompt);
                
                container.innerHTML = `
                    <div class="bg-white p-8 rounded-3xl shadow-xl max-w-2xl w-full text-center fade-in">
                        <div class="flex justify-between items-center mb-4">
                             <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold">×©×œ×‘ ${currentLevel + 1} ××ª×•×š 17</span>
                             <h3 class="text-2xl font-black text-purple-800">×–×”×• ××ª ×”××•×‘×™×™×§×˜ ×”××¡×ª×ª×¨!</h3>
                        </div>
                        <div class="mb-6 rounded-2xl overflow-hidden border-4 border-purple-100 h-80 flex items-center justify-center bg-slate-50 shadow-inner">
                            <img src="${imgUrl}" class="w-full h-full object-cover">
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            ${levels[currentLevel].options.map(opt => `
                                <button onclick="window.checkVisual('${opt}')" class="p-4 border-2 border-purple-100 rounded-2xl hover:bg-purple-600 hover:text-white hover:border-purple-600 font-bold transition-all transform hover:scale-[1.02]">${opt}</button>
                            `).join('')}
                        </div>
                    </div>`;
            }

            window.checkVisual = (ans) => {
                if(ans === levels[currentLevel].answer) score += 300;
                currentLevel++;
                loadLevel();
            };

            loadLevel();
        }

        // --- ×©××¨ ×”××©×—×§×™× (×œ×œ× ×©×™× ×•×™) ---

        function startShamashHunter(container) {
            let score = 0, timeLeft = 30;
            container.innerHTML = `<div class="w-full max-w-xl bg-orange-50 rounded-3xl p-6 game-canvas relative overflow-hidden border-4 border-orange-200" id="hunter-bg">
                <div class="absolute top-4 left-4 right-4 flex justify-between font-black text-orange-900 z-10"><span id="h-time">×–××Ÿ: 30</span><span id="h-score">× ×™×§×•×“: 0</span></div>
                <div id="hunter-area" class="w-full h-full relative"></div>
            </div>`;
            const area = document.getElementById('hunter-area');
            const timer = setInterval(() => {
                timeLeft--;
                if(timeLeft <= 0) { stopAllTimers(); saveScoreModal(score, '×¦×™×™×“ ×”×©××©×™×'); }
                else { document.getElementById('h-time').innerText = '×–××Ÿ: ' + timeLeft; spawnItem(); }
            }, 1000);
            activeIntervals.push(timer);
            function spawnItem() {
                const item = document.createElement('div');
                const isBad = Math.random() > 0.7;
                item.innerHTML = isBad ? 'ğŸŒ€' : 'ğŸ”¥';
                item.className = `absolute text-5xl cursor-pointer select-none`;
                item.style.left = Math.random() * 85 + 5 + '%';
                item.style.top = Math.random() * 80 + 10 + '%';
                area.appendChild(item);
                item.onclick = (e) => { e.stopPropagation(); if(isBad) score = Math.max(0, score - 20); else score += 10; document.getElementById('h-score').innerText = '× ×™×§×•×“: ' + score; item.remove(); };
                setTimeout(() => item.remove(), 1500);
            }
        }

        function startMaccabeeShield(container) {
            container.innerHTML = `<div class="w-full max-w-xl bg-slate-900 rounded-3xl p-4 game-canvas relative overflow-hidden border-4 border-red-500" id="shield-bg">
                <div id="shield-intro" class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 z-20 bg-slate-900/80">
                    <h2 class="text-4xl font-black text-white mb-4">××’×Ÿ ×”××›×‘×™×</h2>
                    <button onclick="beginShield()" class="bg-red-500 text-white px-12 py-4 rounded-full font-bold text-2xl">×”×ª×—×œ</button>
                </div>
                <div id="menorah-base" class="absolute bottom-0 left-1/2 -translate-x-1/2 text-7xl select-none">ğŸ•</div>
                <div class="absolute top-4 left-4 right-4 flex justify-between text-white font-bold"><span id="shield-score">× ×™×§×•×“: 0</span><span id="shield-lives">×—×™×™×: â¤ï¸â¤ï¸â¤ï¸</span></div>
            </div>`;
            window.beginShield = () => {
                document.getElementById('shield-intro').classList.add('hidden');
                let score = 0, lives = 3, speed = 3;
                const spawn = setInterval(() => {
                    const enemy = document.createElement('div');
                    enemy.innerHTML = 'ğŸŒ€';
                    enemy.className = 'absolute text-4xl cursor-pointer select-none';
                    enemy.style.left = Math.random() * 85 + 5 + '%';
                    enemy.style.top = '-50px';
                    document.getElementById('shield-bg').appendChild(enemy);
                    let pos = -50;
                    const fall = setInterval(() => {
                        pos += speed;
                        enemy.style.top = pos + 'px';
                        if (pos > 420) {
                            lives--;
                            document.getElementById('shield-lives').innerText = '×—×™×™×: ' + 'â¤ï¸'.repeat(lives);
                            enemy.remove(); clearInterval(fall);
                            if (lives <= 0) { stopAllTimers(); saveScoreModal(score, '××’×Ÿ ×”××›×‘×™×'); }
                        }
                    }, 30);
                    enemy.onclick = () => { score += 15; speed += 0.1; document.getElementById('shield-score').innerText = '× ×™×§×•×“: ' + score; enemy.remove(); clearInterval(fall); };
                }, 1000);
                activeIntervals.push(spawn);
            };
        }

        function startLightMemory(container) {
            const icons = ['ğŸ•', 'ğŸ©', 'ğŸŒ€', 'ğŸ•¯ï¸', 'ğŸ”¥', 'ğŸº', 'ğŸª™', 'ğŸ“œ'];
            let deck = [...icons, ...icons].sort(() => Math.random() - 0.5);
            let flipped = [], matched = 0, seconds = 0;
            container.innerHTML = `<div class="bg-white p-6 rounded-3xl shadow-xl max-w-lg w-full">
                <div class="flex justify-between items-center mb-6"><div id="mem-timer" class="text-emerald-600 font-bold">×–××Ÿ: 0 ×©× '</div></div>
                <div class="grid grid-cols-4 gap-3" id="memory-grid"></div>
            </div>`;
            const grid = document.getElementById('memory-grid');
            deck.forEach((icon, idx) => {
                const card = document.createElement('div');
                card.className = 'h-20 bg-slate-100 rounded-xl flex items-center justify-center text-3xl cursor-pointer hover:bg-emerald-50 transition-colors border-2 border-transparent';
                card.onclick = () => {
                    if (flipped.length < 2 && !card.classList.contains('matched') && !flipped.includes(card)) {
                        card.innerText = icon; card.classList.add('bg-white', 'border-emerald-500');
                        flipped.push(card);
                        if (flipped.length === 2) {
                            if (flipped[0].dataset.icon === flipped[1].dataset.icon) {
                                flipped.forEach(c => c.classList.add('matched', 'opacity-50'));
                                matched += 2; flipped = [];
                                if (matched === deck.length) { stopAllTimers(); saveScoreModal(1000 - (seconds * 10), '×–×™×›×¨×•×Ÿ ×”××•×¨', seconds); }
                            } else {
                                setTimeout(() => { flipped.forEach(c => { c.innerText = ''; c.classList.remove('bg-white', 'border-emerald-500'); }); flipped = []; }, 800);
                            }
                        }
                    }
                };
                card.dataset.icon = icon;
                grid.appendChild(card);
            });
            const timer = setInterval(() => { seconds++; document.getElementById('mem-timer').innerText = `×–××Ÿ: ${seconds} ×©× '`; }, 1000);
            activeIntervals.push(timer);
        }

        function startDonutPlane(container) {
            container.innerHTML = `<div class="w-full max-w-xl bg-sky-300 rounded-3xl p-4 game-canvas relative overflow-hidden border-4 border-sky-400" id="plane-bg">
                <div class="absolute top-4 left-4 right-4 flex justify-between font-black text-sky-900 z-10"><span id="p-score">× ×™×§×•×“: 0</span></div>
                <div id="plane-donut" class="absolute text-5xl" style="left: 20%; top: 50%;">ğŸ©</div>
                <div id="plane-intro" class="absolute inset-0 bg-sky-500/50 flex flex-col items-center justify-center z-20">
                    <button onclick="beginPlane()" class="bg-yellow-400 px-10 py-3 rounded-full font-bold">×”×ª×—×œ</button>
                </div>
            </div>`;
            window.beginPlane = () => {
                document.getElementById('plane-intro').remove();
                const donut = document.getElementById('plane-donut');
                let score = 0, y = 250, velocity = 0;
                document.getElementById('plane-bg').onclick = () => velocity = -7;
                const gameLoop = setInterval(() => {
                    velocity += 0.4; y += velocity; donut.style.top = y + 'px';
                    if (y < 0 || y > 450) { stopAllTimers(); saveScoreModal(score, '××˜×•×¡ ×”×¡×•×¤×’× ×™×•×ª'); }
                }, 30);
                activeIntervals.push(gameLoop);
            };
        }

        function startTrivia(container, mode) {
            const kidsQs = [{ q: "××™ ×”×™×” ××‘×™ ×”××›×‘×™×?", a: ["×™×”×•×“×”", "××ª×ª×™×”×•", "×©××¢×•×Ÿ"], c: 1 }, { q: "×›××” ×™××™× × ××©×š × ×¡ ×¤×š ×”×©××Ÿ?", a: ["7", "8", "9"], c: 1 }];
            const adultQs = [{ q: "××”×• ×”×’×•×‘×” ×”××§×¡×™××œ×™ ×©×œ ×—× ×•×›×™×™×”?", a: ["10 ×˜×¤×—×™×", "20 ×××”", "30 ×××”"], c: 1 }];
            const qs = mode === 'kids' ? kidsQs : adultQs;
            let current = 0, score = 0;
            function render() {
                if (current >= qs.length) return saveScoreModal(score * 500, mode);
                container.innerHTML = `<div class="bg-white p-10 rounded-3xl shadow-xl max-w-lg w-full text-right"><h3 class="text-2xl font-bold mb-6">${qs[current].q}</h3>
                <div class="space-y-4">${qs[current].a.map((ans, i) => `<button onclick="window.ansT(${i})" class="w-full p-4 border-2 rounded-xl text-right">${ans}</button>`).join('')}</div></div>`;
            }
            window.ansT = (i) => { if(i === qs[current].c) score++; current++; render(); };
            render();
        }

        function startRace(container) {
            container.innerHTML = `<div class="w-full max-w-xl bg-blue-50 rounded-3xl p-4 game-canvas relative overflow-hidden border-4 border-blue-200" id="race-bg">
                <button onclick="beginRace()" class="bg-yellow-400 px-12 py-4 rounded-full font-bold absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">×”×ª×—×œ</button>
                <div id="player" class="hidden absolute bottom-8 text-6xl" style="left: 50%;">ğŸ•</div>
            </div>`;
            window.beginRace = () => {
                const player = document.getElementById('player'); player.classList.remove('hidden');
                document.querySelector('#race-bg button').remove();
                let score = 0;
                document.getElementById('race-bg').onmousemove = (e) => {
                    let rect = e.currentTarget.getBoundingClientRect();
                    player.style.left = ((e.clientX - rect.left) / rect.width) * 100 + '%';
                };
                const interval = setInterval(() => {
                    const item = document.createElement('div');
                    const isGood = Math.random() > 0.3;
                    item.innerHTML = isGood ? 'ğŸ©' : 'ğŸŒ€';
                    item.className = 'absolute text-4xl';
                    item.style.left = Math.random() * 90 + '%';
                    item.style.top = '-50px';
                    document.getElementById('race-bg').appendChild(item);
                    let pos = -50;
                    const fall = setInterval(() => {
                        pos += 5; item.style.top = pos + 'px';
                        if (pos > 380 && pos < 430 && Math.abs(parseFloat(player.style.left) - parseFloat(item.style.left)) < 10) {
                            if (isGood) { score += 10; item.remove(); clearInterval(fall); }
                            else { stopAllTimers(); saveScoreModal(score, '××¨×•×¥ ×”×¡×•×¤×’× ×™×•×ª'); }
                        }
                        if (pos > 500) { item.remove(); clearInterval(fall); }
                    }, 30);
                }, 800);
                activeIntervals.push(interval);
            };
        }

        function startDreidel(container) {
            let score = 0, timeLeft = 20, currentL = '';
            const letters = ['× ', '×’', '×”', '×¤'];
            function next() { currentL = letters[Math.floor(Math.random()*4)]; document.getElementById('d-l').innerText = currentL; }
            container.innerHTML = `<div class="bg-indigo-600 text-white p-10 rounded-3xl text-center w-80 shadow-2xl">
                <div class="flex justify-between mb-4 font-bold"><span>×–××Ÿ: <span id="d-time">20</span></span><span>× ×™×§×•×“: <span id="d-score">0</span></span></div>
                <div id="d-l" class="text-8xl font-black mb-8 bg-white/10 py-8 rounded-2xl">?</div>
                <div class="grid grid-cols-2 gap-3">${letters.map(l => `<button onclick="window.hitD('${l}')" class="bg-white text-indigo-900 p-5 rounded-xl text-3xl font-black">${l}</button>`).join('')}</div>
            </div>`;
            const timer = setInterval(() => { timeLeft--; if(timeLeft <= 0) { stopAllTimers(); saveScoreModal(score, '×¡×‘×™×‘×•×Ÿ ×”×–×”×‘'); } else document.getElementById('d-time').innerText = timeLeft; }, 1000);
            activeIntervals.push(timer);
            window.hitD = (l) => { if(l === currentL) { score += 20; document.getElementById('d-score').innerText = score; next(); } };
            next();
        }

        function saveScoreModal(score, gameName, timeTaken = null) {
            const container = document.getElementById('game-container');
            container.innerHTML = `<div class="bg-white p-10 rounded-[2.5rem] shadow-2xl text-center max-w-sm w-full border-4 border-yellow-100">
                <h2 class="text-3xl font-black mb-2">×›×œ ×”×›×‘×•×“!</h2>
                <p class="text-xl mb-4 text-blue-600 font-bold italic">×¦×‘×¨×ª ${score} × ×§×•×“×•×ª</p>
                <input id="p-name" type="text" placeholder="××” ×”×©× ×©×œ×š?" class="p-4 border-2 rounded-2xl mb-4 w-full text-center font-bold">
                <button onclick="window.fin('${gameName}', ${score})" class="bg-slate-900 text-white p-4 rounded-2xl w-full font-black text-xl hover:bg-blue-600 transition-colors">×©××•×¨ ×ª×•×¦××”</button>
            </div>`;
        }

        window.fin = (g, s) => { 
            const name = document.getElementById('p-name').value || '×©×—×§×Ÿ ×× ×•× ×™××™';
            scores.push({name: name, score: s, game: g}); 
            showSection('leaderboard'); 
        };

        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            if (scores.length === 0) { list.innerHTML = `<div class="p-20 text-center text-slate-400 italic">×¢×“×™×™×Ÿ ××™×Ÿ ×©×™××™×...</div>`; return; }
            list.innerHTML = scores.sort((a,b) => b.score - a.score).map((s, i) => `
                <div class="flex justify-between items-center p-6 hover:bg-slate-50 transition-colors">
                    <span class="w-1/6 text-center text-xl font-black ${i < 3 ? 'text-blue-600' : 'text-slate-300'}">${i+1}</span>
                    <span class="w-2/6 text-right font-bold text-slate-800">${s.name}</span>
                    <span class="w-2/6 text-right text-slate-500 text-sm italic">${s.game}</span>
                    <span class="w-1/6 text-left font-black text-2xl text-blue-600">${s.score}</span>
                </div>
            `).join('');
        }

        renderLobby();
    </script>
</body>
</html>
